#!/usr/bin/env ruby

if ARGV.empty?
  raise "Error: you must specify a stencil file to install"
end

def install_file_exists? file
  basename = file.sub ".zip$", ""
  File.exist?(file) || File.exist?(basename)
end

def install_stencil_file file
  if file =~ /\.zip$/
    if File.exist? file
      system "unzip", file
      system "rm", file
    end
    file = file.sub /.zip$/, ""
    file = File.basename file
  end

  destination = "#{ENV['HOME']}/Library/Application Support/OmniGraffle/Stencils/"
  system "chmod 644 '#{file}'"
  system "mv '#{file}' '#{destination}'"
end

# TODO: support cmdline search/install/remove commands?
#   http://graffletopia.com/search/math%20symbols

ARGV.each do |stencil_file|
  Dir.chdir "#{ENV['HOME']}/tmp"
  if ! install_file_exists? stencil_file
    raise "Error: stencil file: #{stencil_file} does not exist!"
  end

  install_stencil_file stencil_file
end
